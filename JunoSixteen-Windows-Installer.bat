@echo off
chcp 65001 >nul
title üöÄ JunoSixteen - Windows PC Installer
color 0B

echo.
echo ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
echo ‚ñà                                                              ‚ñà
echo ‚ñà            üöÄ JUNOSIXTEEN PC INSTALLER                      ‚ñà
echo ‚ñà        Gamifizierte KI-Lernplattform f√ºr Windows            ‚ñà
echo ‚ñà                                                              ‚ñà
echo ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
echo.

REM Check for Administrator rights
net session >nul 2>&1
if %errorLevel% == 0 (
    echo ‚úÖ Administrator-Rechte erkannt
) else (
    echo ‚ö†Ô∏è  WARNUNG: F√ºr beste Ergebnisse als Administrator ausf√ºhren
    pause
)

echo.
echo üîç SYSTEM-CHECK...
echo ========================================================

REM Check Node.js
node --version >nul 2>&1
if %errorLevel% == 0 (
    echo ‚úÖ Node.js ist installiert
    node --version
) else (
    echo ‚ùå Node.js nicht gefunden!
    echo üì• Lade Node.js herunter...
    start https://nodejs.org/dist/v18.17.1/node-v18.17.1-x64.msi
    echo.
    echo ‚è≥ Bitte installiere Node.js und starte diesen Installer erneut.
    pause
    exit
)

REM Check npm
npm --version >nul 2>&1
if %errorLevel% == 0 (
    echo ‚úÖ npm ist verf√ºgbar
    npm --version
) else (
    echo ‚ùå npm nicht gefunden!
    pause
    exit
)

echo.
echo üì¶ INSTALLATION STARTEN...
echo ========================================================

REM Create installation directory
set INSTALL_DIR=%USERPROFILE%\JunoSixteen
if not exist "%INSTALL_DIR%" (
    mkdir "%INSTALL_DIR%"
    echo ‚úÖ Installationsverzeichnis erstellt: %INSTALL_DIR%
)

REM Copy files to installation directory
echo üìÅ Kopiere Dateien...
robocopy "%~dp0" "%INSTALL_DIR%" /E /XD node_modules .git /XF *.log *.tmp >nul 2>&1

cd /d "%INSTALL_DIR%"

echo.
echo üîß DEPENDENCIES INSTALLIEREN...
echo ========================================================

REM Install main dependencies
echo üì¶ Installiere Haupt-Dependencies...
call npm install --silent

REM Install Electron dependencies
echo üñ•Ô∏è Installiere Electron...
call npm install electron electron-builder --save-dev --silent

REM Install production dependencies
echo ‚ö° Installiere Production-Dependencies...
call npm install express cors helmet compression --save --silent
call npm install firebase-admin @google/generative-ai --save --silent
call npm install axios uuid validator --save --silent

echo.
echo üéÆ FRONTEND SETUP...
echo ========================================================

REM Setup React Native frontend (if needed)
if exist "frontend\JunoApp" (
    echo üì± Setup React Native Frontend...
    cd frontend\JunoApp
    call npm install --silent
    cd ..\..
)

REM Setup mobile app (if needed)
if exist "mobile" (
    echo üì± Setup Mobile Dependencies...
    cd mobile
    call npm install --silent
    cd ..
)

echo.
echo üî• QUESTION POOLS GENERIEREN...
echo ========================================================

REM Generate question pools for all areas
echo üìö Generiere Fragen-Pools...
if exist "generate-question-pools.js" (
    node generate-question-pools.js
    echo ‚úÖ Question Pools generiert
) else (
    echo ‚ö†Ô∏è  Question-Generator nicht gefunden, verwende Demo-Daten
)

echo.
echo üñ•Ô∏è DESKTOP APP ERSTELLEN...
echo ========================================================

REM Build Electron App
echo üî® Baue Desktop-Anwendung...
call npx electron-builder --win --publish=never

echo.
echo üéØ SHORTCUTS ERSTELLEN...
echo ========================================================

REM Create Desktop Shortcuts
set DESKTOP=%USERPROFILE%\Desktop

REM JunoSixteen Demo Shortcut
echo @echo off > "%DESKTOP%\JunoSixteen Demo.bat"
echo cd /d "%INSTALL_DIR%" >> "%DESKTOP%\JunoSixteen Demo.bat"
echo start "JunoSixteen Server" cmd /k "node demo-server.js" >> "%DESKTOP%\JunoSixteen Demo.bat"
echo timeout /t 3 ^>nul >> "%DESKTOP%\JunoSixteen Demo.bat"
echo start "JunoSixteen Desktop" npm run electron >> "%DESKTOP%\JunoSixteen Demo.bat"
echo timeout /t 3 ^>nul >> "%DESKTOP%\JunoSixteen Demo.bat"
echo start "" "http://localhost:3000" >> "%DESKTOP%\JunoSixteen Demo.bat"

REM JunoSixteen Production Shortcut
echo @echo off > "%DESKTOP%\JunoSixteen Production.bat"
echo cd /d "%INSTALL_DIR%" >> "%DESKTOP%\JunoSixteen Production.bat"
echo start "JunoSixteen Production" cmd /k "node server-production.js" >> "%DESKTOP%\JunoSixteen Production.bat"
echo timeout /t 5 ^>nul >> "%DESKTOP%\JunoSixteen Production.bat"
echo start "" "http://localhost:3000" >> "%DESKTOP%\JunoSixteen Production.bat"

REM JunoSixteen Quiz Demo Shortcut
echo @echo off > "%DESKTOP%\JunoSixteen Quiz.bat"
echo cd /d "%INSTALL_DIR%" >> "%DESKTOP%\JunoSixteen Quiz.bat"
echo start "JunoSixteen Quiz" cmd /k "node demo-server.js" >> "%DESKTOP%\JunoSixteen Quiz.bat"
echo timeout /t 3 ^>nul >> "%DESKTOP%\JunoSixteen Quiz.bat"
echo start "" "http://localhost:3000/demo-quiz.html" >> "%DESKTOP%\JunoSixteen Quiz.bat"

echo ‚úÖ Desktop-Shortcuts erstellt

echo.
echo üé® BROWSER-LINKS ERSTELLEN...
echo ========================================================

REM Create Browser bookmark file
echo ^<!DOCTYPE NETSCAPE-Bookmark-file-1^> > "%DESKTOP%\JunoSixteen-Bookmarks.html"
echo ^<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8"^> >> "%DESKTOP%\JunoSixteen-Bookmarks.html"
echo ^<TITLE^>JunoSixteen Bookmarks^</TITLE^> >> "%DESKTOP%\JunoSixteen-Bookmarks.html"
echo ^<H1^>JunoSixteen - Quick Links^</H1^> >> "%DESKTOP%\JunoSixteen-Bookmarks.html"
echo ^<DL^>^<p^> >> "%DESKTOP%\JunoSixteen-Bookmarks.html"
echo     ^<DT^>^<A HREF="http://localhost:3000"^>üè† JunoSixteen Hauptseite^</A^> >> "%DESKTOP%\JunoSixteen-Bookmarks.html"
echo     ^<DT^>^<A HREF="http://localhost:3000/demo-quiz.html"^>üéØ Interactive Quiz Demo^</A^> >> "%DESKTOP%\JunoSixteen-Bookmarks.html"
echo     ^<DT^>^<A HREF="http://localhost:3000/demo-dashboard.html"^>üìä KI Dashboard^</A^> >> "%DESKTOP%\JunoSixteen-Bookmarks.html"
echo     ^<DT^>^<A HREF="http://localhost:3000/standalone-demo.html"^>üöÄ Standalone Demo^</A^> >> "%DESKTOP%\JunoSixteen-Bookmarks.html"
echo ^</DL^>^<p^> >> "%DESKTOP%\JunoSixteen-Bookmarks.html"

echo ‚úÖ Browser-Bookmarks erstellt

echo.
echo üìã KONFIGURATION...
echo ========================================================

REM Create configuration file
echo { > "%INSTALL_DIR%\config\install-config.json"
echo   "installation_date": "%DATE% %TIME%", >> "%INSTALL_DIR%\config\install-config.json"
echo   "installation_path": "%INSTALL_DIR%", >> "%INSTALL_DIR%\config\install-config.json"
echo   "version": "1.0.0", >> "%INSTALL_DIR%\config\install-config.json"
echo   "features": [ >> "%INSTALL_DIR%\config\install-config.json"
echo     "Desktop App", >> "%INSTALL_DIR%\config\install-config.json"
echo     "Web Demo", >> "%INSTALL_DIR%\config\install-config.json"
echo     "TTS Support", >> "%INSTALL_DIR%\config\install-config.json"
echo     "Offline Mode", >> "%INSTALL_DIR%\config\install-config.json"
echo     "Multi-Language", >> "%INSTALL_DIR%\config\install-config.json"
echo     "Firebase Auth" >> "%INSTALL_DIR%\config\install-config.json"
echo   ] >> "%INSTALL_DIR%\config\install-config.json"
echo } >> "%INSTALL_DIR%\config\install-config.json"

echo ‚úÖ Konfiguration gespeichert

echo.
echo üîß WINDOWS REGISTRY EINTR√ÑGE...
echo ========================================================

REM Add to Windows Programs (optional)
reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Uninstall\JunoSixteen" /v "DisplayName" /t REG_SZ /d "JunoSixteen - Gamified Learning Platform" /f >nul 2>&1
reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Uninstall\JunoSixteen" /v "InstallLocation" /t REG_SZ /d "%INSTALL_DIR%" /f >nul 2>&1
reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Uninstall\JunoSixteen" /v "DisplayVersion" /t REG_SZ /d "1.0.0" /f >nul 2>&1

echo ‚úÖ Registry-Eintr√§ge erstellt

echo.
echo üéâ INSTALLATION ABGESCHLOSSEN!
echo ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
echo ‚ñà                                                              ‚ñà
echo ‚ñà                  ‚úÖ JUNOSIXTEEN INSTALLIERT                  ‚ñà
echo ‚ñà                                                              ‚ñà
echo ‚ñà  üìç Installiert in: %INSTALL_DIR%
echo ‚ñà                                                              ‚ñà
echo ‚ñà  üöÄ VERF√úGBARE OPTIONEN:                                     ‚ñà
echo ‚ñà                                                              ‚ñà
echo ‚ñà  1Ô∏è‚É£  Desktop-App:     Doppelklick "JunoSixteen Demo"        ‚ñà
echo ‚ñà  2Ô∏è‚É£  Quiz-Demo:       Doppelklick "JunoSixteen Quiz"        ‚ñà
echo ‚ñà  3Ô∏è‚É£  Production:      Doppelklick "JunoSixteen Production"  ‚ñà
echo ‚ñà  4Ô∏è‚É£  Browser:         http://localhost:3000                 ‚ñà
echo ‚ñà                                                              ‚ñà
echo ‚ñà  üìö FEATURES VERF√úGBAR:                                      ‚ñà
echo ‚ñà  ‚Ä¢ ü§ñ KI-Integration (UL + MCP)                             ‚ñà
echo ‚ñà  ‚Ä¢ üéÆ Gamification mit 10 Leveln                           ‚ñà
echo ‚ñà  ‚Ä¢ üåç 7 Sprachen                                           ‚ñà
echo ‚ñà  ‚Ä¢ üì± Offline-Funktionalit√§t                               ‚ñà
echo ‚ñà  ‚Ä¢ üîä Sprachausgabe                                        ‚ñà
echo ‚ñà  ‚Ä¢ üå± Freiwillige Lernpfade                                ‚ñà
echo ‚ñà  ‚Ä¢ üèÜ Zertifikate & Audit-Trails                          ‚ñà
echo ‚ñà                                                              ‚ñà
echo ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà

echo.
echo üéØ QUICK-START:
echo ========================================================
echo 1. Doppelklicke auf "JunoSixteen Demo" auf dem Desktop
echo 2. Warte 10 Sekunden bis Server startet
echo 3. Browser √∂ffnet automatisch
echo 4. Teste alle Features!

echo.
echo üìû SUPPORT:
echo ========================================================
echo ‚Ä¢ Installation: %INSTALL_DIR%
echo ‚Ä¢ Logs: %INSTALL_DIR%\logs\
echo ‚Ä¢ Config: %INSTALL_DIR%\config\
echo ‚Ä¢ Desktop-Shortcuts: %DESKTOP%

echo.
set /p START_NOW="üöÄ JunoSixteen jetzt starten? (j/n): "

if /i "%START_NOW%"=="j" (
    echo.
    echo üî• STARTE JUNOSIXTEEN...
    start "JunoSixteen Demo Server" cmd /k "cd /d %INSTALL_DIR% && node demo-server.js"
    timeout /t 5 >nul
    start "" "http://localhost:3000"
    echo ‚úÖ JunoSixteen gestartet!
    echo üåê Browser √∂ffnet in 5 Sekunden...
)

echo.
echo üéâ Installation erfolgreich abgeschlossen!
echo üìß Viel Spa√ü mit JunoSixteen!
echo.
pause 